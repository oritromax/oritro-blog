---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const allPosts = await getCollection('blog');
const categories = [...new Set(allPosts.flatMap(post => post.data.categories || ['Uncategorized']))];

const categoryCounts = categories.map(category => {
  const count = allPosts.filter(post => post.data.categories?.includes(category)).length;
  return { category, count };
}).sort((a, b) => b.count - a.count);
---

<Layout title="All Categories">
  <div class="max-w-4xl mx-auto py-8 px-4">
    <div class="mb-8">
      <a 
        href="/" 
        class="text-emerald-400 hover:text-emerald-300 transition-colors inline-flex items-center gap-2 mb-4"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="m15 18-6-6 6-6"/></svg>
        Back to Home
      </a>
      <h1 class="text-3xl font-bold">All Categories</h1>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {categoryCounts.map(({ category, count }) => (
        <a 
          href={`/category/${encodeURIComponent(category)}`}
          class="group relative"
        >
          <div class="absolute inset-0 bg-gradient-to-r from-emerald-400/10 to-purple-400/10 rounded-xl -rotate-1 group-hover:rotate-0 transition-all duration-300"></div>
          <div class="absolute inset-0 border border-white/10 rounded-xl rotate-1 group-hover:rotate-0 transition-all duration-300"></div>
          <div class="relative flex justify-between items-center p-6 bg-gray-800/50 rounded-xl group-hover:bg-gray-800/80 transition-all">
            <span class="text-xl font-medium text-white group-hover:text-emerald-300 transition-colors">{category}</span>
            <span class="bg-gray-700 text-gray-300 px-3 py-1 rounded-full">
              {count} post{count === 1 ? '' : 's'}
            </span>
          </div>
        </a>
      ))}
    </div>
  </div>
</Layout>