---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import TimelinePost from '../../components/TimelinePost.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  
  // Get all unique categories
  const uniqueCategories = [...new Set(allPosts.flatMap(post => 
    post.data.categories || ['Uncategorized']
  ))];
  
  // Create a path for each category
  return uniqueCategories.map(category => {
    // Filter posts that have this category
    const filteredPosts = allPosts.filter(post => 
      post.data.categories?.some(cat => cat.toLowerCase() === category.toLowerCase())
    );
    
    return {
      params: { category: category.toLowerCase() },
      props: { 
        posts: filteredPosts.sort(
          (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
        ),
        category 
      }
    };
  });
}

const { posts, category } = Astro.props;
---

<Layout title={`Category: ${category}`}>
  <div class="max-w-4xl mx-auto py-8 px-4">
    <div class="mb-8">
      <div class="flex items-center gap-4 mb-4">
        <a 
          href="/" 
          class="text-emerald-400 hover:text-emerald-300 transition-colors inline-flex items-center gap-2"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="m15 18-6-6 6-6"/></svg>
          Home
        </a>
        <span class="text-gray-500">/</span>
        <a 
          href="/categories" 
          class="text-emerald-400 hover:text-emerald-300 transition-colors inline-flex items-center gap-2"
        >
          All Categories
        </a>
      </div>
      <h1 class="text-3xl font-bold">Category: {category}</h1>
      <p class="text-gray-400 mt-2">{posts.length} post{posts.length === 1 ? '' : 's'}</p>
    </div>
    
    <div class="space-y-8">
      {posts.map(post => (
        <TimelinePost post={post} />
      ))}
    </div>
    
    {posts.length === 0 && (
      <div class="text-center py-12">
        <div class="text-6xl mb-4">ðŸ˜¢</div>
        <h3 class="text-2xl font-bold mb-2">No posts found</h3>
        <p class="text-gray-400">There are no posts in this category yet.</p>
      </div>
    )}
  </div>
</Layout>